---
title: "Bayesian software"
output: html_document
date: "2023-05-01"
---

Based on slides: https://drive.google.com/drive/folders/1Gw4xOqK1vijalFvP-WWJP030NIyt3nKz
But data are simulaetd
Step 1: install and load the packages
```{r}
#install.packages("R2OpenBUGS")
#install.packages("coda")
#install.packages("readr")
#install.packages("nimble")

library("R2OpenBUGS")
library("coda")
library("readr")
library("nimble")
```


Run the MCMC chain

```{r}

# Define the data
ys <- 171
yn <- 117
n1 <- 3435
n2 <- 4437

# Define the Nimble model
code <- nimbleCode({
  # Priors for theta_plus and theta_minus
  theta_plus ~ dbeta(172, 3265)
  theta_minus ~ dbeta(118, 4321)
  
  # Calculate the relative risk
  rr <- theta_plus / theta_minus
})

model <- nimbleModel(code)#, data = list(ys = ys, yn = yn, n1 = n1, n2 = n2))

# Compile the model
compiled_model <- compileNimble(model)

# Set the parameters to monitor
parameters <- c("theta_plus", "theta_minus", "rr")

# Run the MCMC algorithm
osteo.sim <- nimbleMCMC(code = compiled_model,
                        monitors = parameters,
                        niter = 1500,
                        nburnin = 750,
                        nchains = 3,
                        thin = 1,
                        samplesAsCodaMCMC = TRUE)

# Summarize the posterior distribution
print(summary(osteo.sim))

```
Produce general summary of obtained MCMC sampling

```{r}
print(osteo.sim)
plot(osteo.sim)
```
Step 10: Convert osteo.sim into mcmc.list for processing with CODA

```{r}
osteo.mcmc <- as.mcmc.list(osteo.sim)
```

Step 11: Produce general summary of obtained MCMC sampling

```{r}
plot(osteo.mcmc)
summary(osteo.mcmc)
```

Skip Step 12-13 in her slides:

▷ Step 12: Specific output obtained from CODA functions
> par(mfrow=c(2,2)) # plot figures in 2x2 format if function allows
> traceplot(osteo.mcmc) # trace plots
> cumuplot(osteo.mcmc,ask=FALSE) # running mean plots
> acfplot(osteo.mcmc) # autocorrelation function plot
> autocorr(osteo.mcmc) # autocorrelation values
> crosscorr.plot(osteo.mcmc) # cross-correlation output
> densplot(osteo.mcmc) # density plots of the marginal posteriors
> effectiveSize(osteo.mcmc) # effective size
> HPDinterval(osteo.mcmc) # HPD intervals of all parameters
▷ Step 13: Other functions: convergence tests
> gelman.diag(osteo.mcmc)
> gelman.plot(osteo.mcmc,ask=FALSE)
> geweke.diag(osteo.mcmc)
> geweke.plot(osteo.mcmc,ask=FALSE)
